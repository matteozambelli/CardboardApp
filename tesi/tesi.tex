%----------------------------------------------------------------------------------------
%	PACKAGES AND OTHER DOCUMENT CONFIGURATIONS
%----------------------------------------------------------------------------------------

\documentclass[12pt,a4paper,twoside, italian, openright]{book}
\usepackage[latin1]{inputenc}
\usepackage[italian]{babel}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{subfigure}
\usepackage[left=3.00cm, right=3.00cm, top=3.00cm, bottom=3.00cm]{geometry}
\usepackage{setspace}
\usepackage{fancyhdr}
\usepackage{emptypage}
\usepackage{verbatim}
\usepackage[usenames,dvipsnames]{xcolor}
%inserire i link senza colorarli o riquadrarli:
\usepackage{hyperref}
\hypersetup{
	colorlinks=false,
	allbordercolors=White,
}
%elenchi con lettere:
\usepackage{enumerate}
% stili per inserire codice
\usepackage{listings}
\usepackage{caption}

\lstdefinestyle{numeri}{
	numbers=left, % where to put the line-numbers
	numberstyle=\tiny\color{Black} % the style that is used for the line-numbers
	%stepnumber=2, % the step between two line-numbers
	%numbersep=10pt, % how far the line-numbers are from the code
}
\lstdefinestyle{stiliComuni}{
	frame=single, % adds a frame around the code
	basicstyle={\normalsize\ttfamily},
	backgroundcolor=\color{black!5!white}, % choose the background color;
	showstringspaces=false, % underline spaces within strings only
	showspaces=false, % show spaces everywhere adding particular underscores		
	keepspaces=true, % keeps spaces in text 
	tabsize=2, % sets default tabsize to 2 spaces
	breaklines=true, % sets automatic line breaking
	showtabs=false,
	captionpos=b % sets the caption-position to bottom
}

%stile codice xml
\lstdefinelanguage{XML}{
	otherkeywords={policy, signer, default, package, seinfo},
	morecomment=[s]{<!--}{-->}
}
%linguaggio e stile policy
\lstdefinelanguage{Policy}{
	keywords={isSystemServer,user,domain,type,seinfo, typealias, allow, neverallow}
	%morecomment=[l]{#}
	%moreidentifiers={},
	%identifierstyle=\color{MidnightBlue},	
}
\lstset{
	frame=single,
	basicstyle={\normalsize\ttfamily},
	stringstyle=\color{YellowOrange},
	commentstyle=\color{OliveGreen},
	keywordstyle=\color{RubineRed},
	identifierstyle=\color{MidnightBlue},
	style=numeri,
	style=stiliComuni
}

%per scrivere tag xml
\newcommand*{\xml}[1]{\texttt{<#1>}}

%interlinea 1.5
\onehalfspacing

%numeri di pagina dispari a dx e pari a sx nel piè di pagina
\pagestyle{fancy}
\fancyhf{}
\fancyfoot[LE,RO]{\thepage}
\fancypagestyle{plain}{\fancyfoot[RO,LE]{\thepage}}



\author{Fabio Terzi and Matteo Zambelli}
\title{A Low Cost virtual reality game for amblyopia}


\renewcommand{\baselinestretch}{1.5} 
\newcommand{\virgolette}[1]{``#1''}
%----------------------------------------------------------------------------------------
%	TITLE SECTION
%----------------------------------------------------------------------------------------

\author{Fabio Terzi, Matteo Zambelli} % Your name

\begin{document}

%----------------------------------------------------------------------------------------
%	Ringraziamenti
%----------------------------------------------------------------------------------------	
	
\chapter*{}
\thispagestyle{empty}
	\vspace{\fill}
	\begin{flushright}
		Ringraziamo il Professor Angelo Gargantini per i preziosi insegnamenti, inoltre vogliamo ringraziare le nostre famiglie per il sostegno ed il grande aiuto.\\ 
		\textit{Fabio e Matteo}
		
	\end{flushright}
	
\thispagestyle{empty}	
\tableofcontents % l'indice


%----------------------------------------------------------------------------------------
%	introduzione
%----------------------------------------------------------------------------------------


\chapter{Introduzione}

Il progetto 3D4Amb mira a sviluppare un sistema basato sul 3D per la diagnosi e il trattamento dell'ambliopia nei bambini piccoli.\\
Sfrutta la tecnologia 3D active shutter per garantire una visione binoculare, cioè per mostrare immagini diverse all'occhio normale e all'occhio pigro. Essa dovrebbe consentire una facile diagnosi dell'ambliopia e il suo trattamento per mezzo di giochi interattivi e attività di intrattenimento. Non dovrebbe soffrire dei problemi del trattamento classico dell'occlusione, è adatto ad un uso domestico, e potrebbe, almeno in parte, sostituire l'occlusione dell'occhio normale.\\                           
L'obiettivo principale di questo progetto di ricerca, denominato 3D4Amb, è di sviluppare un sistema per la diagnosi e il trattamento di ambliopia, basata sulla visione binoculare in modo accessibile. Con il termine accessibile si intende: poco costoso, user friendly, adatto per uso domestico e facilmente estendibile.\\
Tutte le informazioni sul progetto sono reperibili sul sito: http://3d4amb.unibg.it/
Car Racing Cardboard è un'applicazine per la piattaforma Android, il suo scopo è curare una patologia come l'ambliopia attraverso un gioco, in modo tale da far divertire il paziente ed allo stesso tempo sottoporlo al trattamento per la cura della sua malattia.

%----------------------------------------------------------------------------------------
%	l'ambliopia
%----------------------------------------------------------------------------------------

\chapter{L'Ambliopia}

\section{Il disturbo}
L'ambliopia è una condizione di ridotta acuità visiva mono o bilaterale e si manifesta indipendentemente da causa organica. È dovuta ad una inadeguata stimolazione visiva
durante il periodo plastico del sistema visivo, ossia il periodo che va dalla nascita fino ai sette anni.\\
Il soggetto in cui è presente l'ambliopia soffre di un alterazione della visione dello spazio: le immagini che provengono dagli occhi non vengono correttamente rielaborate all'interno del cervello. Questo causa una scorretta comprensione dello spazio che lo circonda e causa una percezione scorretta della profondità, dei movimenti e dei contrasti.
È presente nel 2-4\% della popolazione, la sua incidenza è più elevata in associazione con alcune condizioni quali prematurità, sindrome di Down, patologia neurologica e familiarità per ambliopia o strabismo. Spesso le persone non si accorgono nemmeno di esserne affette fino ai 20-30 anni, per questo è fondamentale la diagnosi.\\
Può colpire i bambini dalla nascita fino ai 7 anni, età in cui il sistema visivo raggiunge la sua maturità. Durante questo periodo iniziale l'ambliopia può essere trattata e prevenuta, mentre superata questa fase l'istaurazione della malattia diventa impossibile, ma, nel caso fosse presente, essa risulta irreversibile. L'ambliopia funzionale deve essere distinta dall'ambliopia organica, la quale è un impoverimento della visione, causata da anomalie strutturali dell?occhio o del cervello, che sono indipendenti dagli input sensoriali.\\
L'ambliopia funzionale è reversibile se trattata con la stimolazione visiva adeguata, mentre quella organica non subisce alcun beneficio da una stimolazione visiva.
Il videogame di rebalance ha quindi effetto solo sull'ambliopia funzionale e non su quella organica.
\newpage
\section{Trattamenti}
Il trattamento precoce dell'ambliopia è fondamentale per ottenere buoni risultati, la correzione oculare avviene in diversi modi:

\subsection{Occlusione}
La terapia occlusiva si basa sulla copertura dell'occhio sano per stimolare l'occhio ambliope. Solitamente nei pazienti affetti anche da strabismo l'occlusione avviene a tempo pieno; tuttavia l'occlusione  a tempo pieno, o occlusione totale, può causare un ambliopia inversa nei soggetti sotto i 4-5 anni. Per evitare l'insorgere di questo ulteriore problema, la condizione dell'ambliopia deve essere monitorata ogni settimana per l'età del bambino. Per esempio, un bambino di due anni va monitorato ogni due settimane, uno di tre ogni tre settimane. Nel caso in cui venga riscontrato che il paziente non sopporta un'occlusione totale si applica un'occlusione parziale, ossia solo qualche ora al giorno.

\subsection{Penalizzazione ottica}
Attuata con filtri di Bangerter (lenti con gradi diversi di opacizzazione, a seconda della entità della penalizzazione che si vuole attuare) o con  lenti più forti o più deboli poste davanti all'occhio sano per costringere quello malato a lavorare; come l'occlusione parziale, viene attuata o per coloro che  necessitano di una occlusione ''morbida'' o come terapia di mantenimento.

\subsection{Penalizzazione farmacologica}
Viene effettuata con un collirio cicloplegico instillato nell?occhio sano per escluderlo dal processo di visione e costringere quello malato a lavorare.

\subsection{Settorizzazione}
Consiste nella copertura di parte del campo visivo dell?occhio sano con pellicole adesive traslucide sugli occhiali. \\
Per il trattamento dell'ambliopia sono stati proposti anche degli stimolatori visivi di tipo elettrico (trattamento CAM-Cambridge Stimulator e trattamento Flicker): vengono inviati stimoli luminosi di vario tipo sulla retina dell'occhio ambliope, forzandolo  a trasmettere l'impulso luminoso al cervello, e riattivando così i canali "impigriti" dall'ambliopia. L'efficacia di queste metodiche è ancora oggi molto dibattuta.  Recentemente si stanno utilizzando farmaci neuroprotettivi come sostegno alla terapia occlusiva: studi recenti indicano che in questo modo viene potenziato l'effetto della terapia occlusiva e viene più facilmente stabilizzato il miglioramento della funzione visiva.
\newpage
\section{L'idea di 3D4Amb}
3D4Amb ha ideato un sistema basato sulle tecnologie 3D per consentire la visione binoculare. L'uso classico di un sistema 3D è quello di fornire ai due occhi diverse immagini della stessa scena con angoli di visualizzazione leggermente sfalsati che corrispondono ai diversi punti di vista dell' occhio destro e sinistro. Questa visione produce un'illusione di profondità della scena ed è la base della realtà virtuale.\\                                                         
Il principio primario del sistema è che all?occhio ambliope (o occhio pigro) e all'occhio normale sono mostrate due immagini differenti ma correlate. Questo principio può essere utilizzato nella pratica per il trattamento di ambliopia, andando a mostrare all'occhio ambliope la parte più interessante dei frame della clip o del gioco, mentre all'occhio non ambliope (o buono) viene mostrata la parte meno interessante.\\
Il contenuto da mostrare al paziente (gioco o immagine) viene diviso da 3D4Amb in due parti, una per l'occhio destro (occhio ambliope, Figura ~\ref{idea 3D4Amb}) e una per l'occhio sinistro (occhio buono, Figura ~\ref{idea 3D4Amb}). Il software 3D4Amb deciderà cosa inviare ad entrambi gli occhi a seconda del tipo di trattamento suggerito dal medico. Si noti che l'occhio pigro del bambino è più stimolato a lavorare, ma l'occhio sano non è ''patchato''. Il cervello del paziente ha il compito di unire le due immagini per visualizzare il frame completo con successo ed eseguire correttamente operazioni semplici in caso di gioco interattivo. Per assicurarsi che il paziente possa unire le due immagini sono presenti un numero significativo di elementi comuni ad entrambe le immagini. Notare che il frame finale è una rappresentazione bidimensionale in quanto l'obiettivo è quello di non stimolare la visione stereo del paziente (almeno inizialmente).\cite{tesiTZ}


\begin{figure}[t]
	\centering
	\includegraphics[width=\columnwidth]{immagini/3D4Amb_sys.png}
	\caption{La tecnologia di 3D4Amb \label{idea 3D4Amb}}
\end{figure}

%----------------------------------------------------------------------------------------
%	la tecnlogia per il trattamento
%----------------------------------------------------------------------------------------
\chapter{La tecnologia per il trattamento}
\section{Sistema operativo ed ambiente di sviluppo:}
L'applicazione è stata progettata e sviluppata per il mondo Android. I software utilizzati per l'implementazione sono stati:
\begin{itemize}
	\item L'ultima versione del JDK, il kit di sviluppo per la tradizionale programmazione Java, reperibile dal sito Oracle\footnote{http://www.oracle.com/technetwork/java/javase/downloads/index.html} .
	\item L'IDE (ambiente di sviluppo integrato) Android Studio, alternativa fresca e promettente ad Eclipse. La sua installazione include il pacchetto di strumenti Android SDK, il quale è costituito da programmi, emulatori e piattaforme per ogni versione di Android. La sua composizione inoltre non è immutabile, ma viene gestita tramite il programma Android SDK Manager, avviabile dall'IDE, grazie al quale siamo stati in grado di profilare le piattaforme e gli strumenti presenti nel SDK nella maniera più congeniale al nostro lavoro.
	
\end{itemize}

In particolare si è deciso che il requisito minimo che deve possedere lo smartphone dell'utente che utilizza l'applicazione sia un livello di API(Application Programming Interface) 15, ovvero dal sistema operativo Android 4.0.3 \footnote{(ICE\_CREAM\_SANDWICH\_MR1)} in poi.
\subsection{Perchè Android:}
La scelta di sviluppare l'applicazione per il sistema operativo Android, anzichè ad esempio per iOS o Windows Phone, è figlia delle seguenti riflessioni:
Innanzitutto il sistema Android sta dilagando. Non è più solo questione di smartphone o tablet. Si sta imponendo come sistema operativo in grado di animare qualsiasi dispositivo più o meno mobile tanto da apparire, in prospettiva non troppo futuristica, una presenza sempre più costante nel nostro quotidiano. Gli è stata inoltre attribuita la più veloce diffusione mai vista per un sistema operativo mobile. Gran parte del merito è dovuto alle radici ben salde nel mondo open source. Il sistema operativo Android, infatti, è figlio di Linux, ed ha attirato l'interesse di tanti sviluppatori  che per anni si sono stretti intorno ai grandi bacini del software libero. Accoglie inoltre in sé tutto il meglio di quanto è stato ideato per supportare lo sviluppo del web, desktop e mobile sia in termini di pattern progettuali che di librerie software. Per decretare un successo tanto ampio è necessario che ci sia anche un forte riscontro di pubblico. Sicuramente un qualcosa che ha contraddistinto questo sistema è stata la sua adozione da parte di dispositivi molto diversi tra loro, non solo per tipologia (smartphone piuttosto che tablet), ma soprattutto per fasce di prezzo, da poche decine di euro fino a  cifre piuttosto significative. 
Ciò ne ha permesso una diffusione molto diverficata trasversalmente alle diverse categorie sociali, ma ha causato di riflesso una frammentazione notevole dello scenario applicativo costringendo gli sviluppatori ad una particolare cura degli aspetti di adattamento alle caratteristiche del dispositivo ospite. Proprio in questo, Android ha dimostrato la sua grande modernità offrendo tutto il supporto necessario per permettere all'applicazione in esecuzione di adeguarsi ad ogni circostanza.
\subsection{Perchè Android Studio:}
Dopo aver scelto per quale sistema operativo sviluppare, un'altra importante scelta è stata quella di identificare l'IDE più adatto alle nostre esigenze.
Android Studio è un' alternativa giovane ma molto promettente rispetto ad Eclipse. Esso è sponsorizzato direttamente da Google e pensato appositamente per Android. Gli elementi di Android Studio che spiccano maggiormente sono:
\begin{itemize}
	\item l'utilizzo di Gradle come strumento di build automation, atto quindi ad accompagnare lo sviluppatore nelle fasi di build, sviluppo, test e pubblicazione della propria app;
	\item disponibilità di un gran numero di template per la realizzazione di applicazioni già in linea con i più comuni pattern progettuali;
	\item editor grafico per la realizzazione di layout, molto pratico e dotato di un ottimo strumento di anteprima in grado di mostrare l'aspetto finale dell?interfaccia che si sta realizzando in una molteplicità di configurazioni (tablet e smartphone di vario tipo).
\end{itemize}

\begin{figure}
	\centering
	\includegraphics[width=0.45\linewidth, height=0.3\textheight]{immagini/android-logo}
	\caption{Android Logo}
	\label{fig:android-logo}
\end{figure}
\newpage
\section{Google cardboard} \label{sectionGC}
Google cardboard è una piattaforma per la realtà virtuale sviluppata da Google. Creato da  David Coz e Damien Henry, due ingegneri della Google, nel Google Cultural Institute  a Parigi nel loro 20\%  \virgolette{Innovation Time Off} \cite{GCfb}

\begin{figure}[ht!]
	\centering
	\includegraphics[width=\columnwidth]{immagini/Google-Cardboard.jpg}
	\caption{Google Cardboard}\label{googlecardboard}
\end{figure}

Introdotto nel 2014 al \virgolette{Google I/O developers conference for Android device}, è formato da un cartone ripiegabile e due lenti, l'utente deve inserirci lo smartphone (Figura ~\ref{googlecardboard}). Questo sistema consente una visione stereoscopica, funziona con differenti smartphone e può essere facilmente usato dai bambini.\\
Google cardboard non consente un' esperienza immersiva come Oculus rift, il quale necessita però di un PC collegato (ed è ancora in fase di sviluppo), ma è un modo facile ed economico per provare l'esperienza della realtà virtuale, inoltre la maggior parte delle applicazioni sono reperibili gratuitamente.
\linebreak
\textbf{Esistono rischi per la salute?}\\
Ad oggi non esistono evidenze scientifiche certe e rilevanti a supporto della tesi secondo cui le tecnologie 3D siano responsabili (o corresponsabili) della patogenesi di disturbi e difetti a carico dell'apparato della vista.\\
Tuttavia, è importante notare che l'assenza di prove a sostegno della tesi non implica la sua totale infondatezza, cioè in altre parole almeno per il momento non siamo in grado di mettere in relazione con certezza i due elementi.

	



%----------------------------------------------------------------------------------------
%	l'applicazione
%----------------------------------------------------------------------------------------

\chapter{Car Racing Cardboard: l'applicazione}
\section{Il principio del trattamento tramite il gioco:}
L' applicazione sviluppata in questo progetto di tesi, punta a sfruttare le potenzialità del Google Cardboard per correggere il disturbo dovuto all'ambliopia. Fino ad ora, il trattamento standard consolidato per la cura della malattia è stato l'occlusione visiva.
Questa tecnica può però presentare alcuni limiti: 
\begin{itemize}
	\item in primo luogo la compliance (adesione del paziente alla terapia) è un fattore limitante da non trascurare, soprattutto quando la profondità dell'ambliopia richiede tempi lunghi di trattamento;
	\item Inoltre, l'occlusione è gravata dalla tendenza alla perdita di efficacia nel breve periodo. Infatti fino al 50\% dei benefici ottenuti vengono persi, se i risultati funzionali non sono stati resi stabili, prolungando il trattamento per un tempo sufficientemente lungo, dopo che si è registrato il miglioramento del visus.
\end{itemize}

Probabilmente la tendenza alla perdita di effetto è dovuta, almeno in parte, al fatto che l'occlusione non affronta un altro importante aspetto della terapia dell'ambliopia, cioè la stimolazione diretta dell'occhio con il deficit visivo. Sulla base di questo, si è quindi pensato di realizzare un gioco interattivo che punti alla cura dell'occhio ampliope in modo più coinvolgente.
Grazie quindi all'accessibilità dei Google Cardboard, all' evoluzione del mondo Android ed all'intrattenimento volontario ed intrinsecamente motivato dato dal gioco, è stato possibile creare un metodo di cura innovativo.
\begin{figure}[!ht]
	\centering
	\includegraphics[width=\columnwidth]{immagini/child_cardboard}
	\caption{Interactive game scene}
	\label{fig:child_cardboard}
\end{figure}
\newpage
\section{Il gioco:}
\subsection{Obiettivo:}
L' applicazione Car Racing Cardboard consiste in un gioco il cui obiettivo è quello di ottenere il maggior punteggio possibile. L'utente ha la possibilità di manovrare un veicolo attraverso tre corsie. Il punteggio del gameplayer incrementa ogni volta che si evita un ostacolo, costituito dalle macchine che pervengono nella nostra direzione sulle tre corsie. Inizialmente la posizione del veicolo controllato dall'utente è nella corsia centrale, ma non appena inizia il gioco, si ha la possibilità di spostarsi a destra o a sinistra. Lo spostamento del veicolo viene gestito tramite un dispositivo bluetooth collegato allo smartphone o tramite degli auricolari aventi i pulsanti UP, DOWN e PLAY. Oltre al punteggio, esistono altre due variabili dipendenti dal comportamento dell'utente: una che conteggia le vite a disposizione ed una che indica il livello raggiunto. Inizialmente il gameplayer ha a disposizione un totale di tre vite, le quali decrementano nel momento in cui avviene una colluttazione con una macchina proveniente dal verso opposto. Il livelli inoltre incrementano col passare del tempo. La difficoltà del gioco, caratterizzata dal numero e dalla velocità dei nemici, incrementa con l'aumentare dei livelli.
\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{immagini/game}
	\caption{Game scene}
	\label{fig:game}
\end{figure}
\subsection{Doppia Viewport:}
Come si può vedere dall'immagine 5.2, l'applicazione viene realizzata renderizzando sullo smartphone dell'utente una doppia Viewport. Questo sdoppiamento, grazie alla tecnologia offerta dal Google Cardboard, permette all'utente una visione stereoscopica del gioco. Le due Viewport sono inoltre fondamentali per il principio di funzionamento della nostra applicazione. Infatti, grazie ad esse è possibile trattare in modo differente l'occhio sinistro dall'occhio destro, e più specificatamente l'occhio ambliope dall'occhio sano. Prima dell'inizio del gioco vero e proprio, l'applicazione da la possibilità di scegliere l'occhio pigro:
\begin{figure}[ht]
	\centering
	\includegraphics[width=\columnwidth]{immagini/chooselazyeye_left}
	\caption{Choose the lazy eye}
	\label{fig:chooselazyeye_left}
\end{figure}
In questo modo si da all'applicazione l'opportunità di trattare l'occhio pigro in modo da svilupparne la visione. In particolare l'applicazione andrà a penalizzare l'occhio sano riducendo l'opacità di alcuni elementi che caratterizzano la Viewport come ad esempio i veicoli nemici o il paesaggio, in modo da stimolare e sforzare l'occhio pigro ad allenarsi. La penalizzazione avviene in modo dinamico ed è la chiave della cura. Essa aumenta con l'aumentare dello score e dei livelli raggiunti dall'utente. 

\newpage
\section{Guida all'utilizzo:}

Dopo aver scaricato l'applicazione da Google Play Store \footnote{https://play.google.com/store/apps/details?id=it.unibg.p3d4amb.carracingcarboard\&hl=it}
è possibile friure dei contenuti di Car Racing Cardboard.
Connettere quindi lo smartphone agli auricolari, ma aspettare ad inserirlo nel visore 3D.
La schermata di avvio è la seguente (Figura \ref*{login_activity}):
\begin{figure}[ht]
	\centering
	\includegraphics[width=80mm]{immagini/login}
	\caption{Schemata di avvio}
	\label{login_activity}
\end{figure}
Da questa schermata è possibile effettuare il log in, se l'utente è gia registrato, in caso contrario è possibile registrarsi premendo sul bottone \virgolette{SIGN UP}.
Prima della schermata di registrazione il sistema mostra un messaggio per ricordare all'utente (qualora esso non sia il pazeinte, ad esempio un genitore) di inserire i dati del paziente, poichè non avrebbe senso raccogliere informazioni forvianti (Figura \ref{warning_signup})
\begin{figure}[ht]
	\centering
	\includegraphics[width=60mm]{immagini/warning_registration}
	\caption{Pop up di warning}
	\label{warning_signup}
\end{figure}
Cliccando su \virgolette{CONTINUE} si entra nella vera schermata di registrazione (Figura \ref{popup_signup} ):
\begin{figure}[ht]
	\centering
	\includegraphics[width=60mm]{immagini/registration}
	\caption{Registrazione nuovi utenti}
	\label{popup_signup}
\end{figure}

Qui bisogna inserire: Nome, Cognome, email, data di nascita, colore preferito e password. Il colore viene utilizzato in caso di password dimenticata, come domanda di sicurezza.
Nell'eventualità in cui un utente si dimentichi la sua password, dalla schermata iniziale (Figura \ref*{login_activity}) premendo su \virgolette{forgot your password?} si accede al pop up di ripristino (Figura \ref{resetpassword}).
\begin{figure}[ht]
	\centering
	\includegraphics[width=60mm]{immagini/resetpassword}
	\caption{Pop up di reset della password}
	\label{resetpassword}
\end{figure}

Inserendo l'indirizzo email valido ed il colore corretto, il sistema invia una mail con la nuova password, che sarà possibile ri-personalizzare premendo su \virgolette{update your info} (Figura \ref{login_activity}).
Sempre dalla schermata iniziale è possibile, premendo su \virgolette{?} aprire il sito dedicato a Car Racing Cardboard\footnote{http://3d4amb.unibg.it/3dcar/cardboard\%20site/}.
Cliccando su \virgolette{collaborate with us} è possibile inviare una mail allo staff di 3D4Amb, questo possibilità è stata pensata per collaborazioni con medici e/o centri di ipovisione, interessati a collaborazioni(cFigura \ref{cwu}).

\begin{figure}[ht]
	\centering
	\includegraphics[width=60mm]{immagini/collaborate_with_us}
	\caption{Pop up collaborate with us}
	\label{cwu}
\end{figure}

In questo caso, è stata prevista la possibilità per i dottori di gestire più pazienti con un unico account, infatti, il sistema è in grado di riconoscere un dottore registrato e lo reindirizza ad una pagina apposita (Figura \ref{doctor_activity}).

Un utente può anche accedere al gioco senza registrarsi sul nostro sistema, cliccando su \virgolette{PLAY WITHOUT REGISTRATION}, in questo caso però non godrà degli stessi servizi di un utente loggato.
\begin{figure}[ht]
	\centering
	\includegraphics[width=80mm]{immagini/doctor}
	\caption{Schermata per i dottori}
	\label{doctor_activity}
\end{figure}

\paragraph{Avvio del gioco:}dopo aver effettuato il log in o aver avviato l'applicazione con l'opzione senza registrazione, inserire lo smartphone nel visore 3D.
Inserire nel sistema a quale occhio si desidera somministrare il trattamento (Figura \ref{fig:chooselazyeye_left}), e premere conferma.
A questo punto inizia il gioco vero e proprio.



%----------------------------------------------------------------------------------------
%	Software
%----------------------------------------------------------------------------------------
\chapter{Il software}
\section{Architettura di sistema}
Il sistema prevede le seguenti componenti:
\begin{itemize}
	\item Google Cardboard (vedi sezione \ref{sectionGC})
	\item Smartphone Android con connessione internet attiva
	\item Auricolari con tasti di controllo del volume
	\item Server con database MySql
\end{itemize}
\begin{figure}[ht]
\centering
\includegraphics[width=160mm]{immagini/architettura_di_sistema}
\caption{Architettura di sistema}
\label{AS}
\end{figure}
\newpage
Lo smartphone (con S.O. Android) va inserito nel visore, ad esempio Google Cardboard, ma qualora si disponesse di un qualsiasi visore 3D per smartphone il risultato sarà lo stesso,
al dispositivo vanno collegati degli auricolari con il controllo del volume (come quelli che si trovano nelle confezioni dei telefoni all'acquisto), saranno necessari  per controllare il movimento della macchinina.
\paragraph{La scelta degli auricolari come controller}è nata dopo aver notato come l'utilizzo dell'accelerometro (sensore presente su ogni smartphone) come strumento per catturare i comandi dell'utente, causasse un senso di nausea dopo pochi minuti di gioco, si è quindi deciso di utilizzare un controllore esterno.\\

Dopo di che si è dovuto scegliere il tipo doi controllore, dato che i movimenti da controllare erano solo due (sposta a destra e a sinistra l'auto) per essere coerenti con la scelta di un sistema \textbf{low cost}, la scelta non è ricaduta su un joy-pad, ma piuttosto sugli auricolari dotati del controllo volume, presenti nella confezione degli smartphone o acquistabili a pochi euro.

\paragraph{Il server}è utilizzato per salvare lo storico dei risultati di tutti gli utenti che ne hanno espresso il desiderio, in questo modo è possibile tenere traccia dei loro miglioramenti; è quindi necessario che lo smartphone sia connesso ad internet per poter trasmettere i risultati. Il server è il cs.unibg.it e utilizza un database MySql è installato presso il dipartimento di ingegneria dell'Università degli Studi di Bergamo\footnote{http://www.unibg.it/} a Dalmine(Bg). 
\newpage
\section{Casi d'uso}
%\section{Requisiti funzionali e casi d'uso}
%\subsection{Definizioni dei requisiti:}
%\subsection{Analisi del contesto:}
%\subsection{Scenari e casi d' uso:}
\subsubsection{Sign Up:}
\paragraph{Attori:} Utente
\paragraph{Precondizioni:} E' necessaria una connessione ad internet.
\paragraph{Passi principali:}
\begin{enumerate}
	\item L'utente lancia l'applicazione.
	\item L'utente clicca sul pulsante di Sign Up.
	\item L'utente inserisce i propri dati (first name, last name, email, birthday, favourite color, password, password di conferma) e clicca Ok.
\end{enumerate}
\paragraph{Situazioni eccezionali:}
\begin{enumerate}
	\item[1a.] L'utente lascia vuoti alcuni campi.
	\item[1b.] L'applicazione risponde con un toggle che segnala che alcuni campi sono da compilare e non permette il Sign Up.
\end{enumerate}
\begin{enumerate}
	\item[2a.] L' email inserita dall' utente non esiste.
	\item[2b.] L'applicazione risponde tramite una warning, segnalando all'utente l'insesistenza dell'email inserita, non permettendo la registrazione.
\end{enumerate}
\begin{enumerate}
	\item[3a.] L' email inserita dall' utente è già presente nel database.
	\item[3b.] L'applicazione risponde tramite una warning, segnalando all'utente che la mail non è valida, non permettendo la registrazione.
\end{enumerate}
\begin{enumerate}
	\item[4a.] La data di nascita inserita non è valida.
	\item[4b.] L'applicazione risponde tramite una warning, non permettendo la registrazione.
\end{enumerate}
\begin{enumerate}
	\item[5a.] La password di conferma non corrisponde alla password inserita.
	\item[5b.] L'applicazione risponde tramite una warning, segnalando l'errore e non permettendo il Sign Up.
\end{enumerate}

\paragraph{Postcondizioni:}
I dati inseriti dall'utente sono validi e vengono registrati sul database MySql. L'utente è in grado sfruttare tutti i servizi offerti dall'applicazione accedendo tramite la fase di Log In.

\subsubsection{Log In utente comune:}
\paragraph{Attori:} Utente
\paragraph{Precondizioni:} E' necessaria una connessione ad internet.
\paragraph{Passi principali:}
\begin{enumerate}
	\item L'utente lancia l'applicazione.
	\item L'utente inserisce i campi email e password utilizzati nella fase di Sign Up.
	\item L'utente clicca sul pulsante di Log In.
\end{enumerate}
\paragraph{Situazioni eccezionali:}
\begin{enumerate}
	\item[1a.] L'utente lascia vuoto il campo email o il campo password.
	\item[1b.] L'applicazione risponde con un toggle, il quale segnala che alcuni campi sono da compilare e non permette il Log In.
\end{enumerate}
\begin{enumerate}
	\item[2a.] L'utente inserisce un email non presente nel database.
	\item[2b.] L'applicazione risponde tramite una warning, segnalando all'utente la non presenza dell' email nel database MySql.
\end{enumerate}
\begin{enumerate}
	\item[3a.] L'utente inserisce un email presente nel database ma con password scorretta.
	\item[3b.] L'applicazione risponde tramite una warning, segnalando all'utente che la password inserita non è corretta, non permettendo il Log In.
\end{enumerate}
\paragraph{Postcondizioni:}
Le credenziali di accesso inserite dall'utente sono valide ed il Log In viene eseguito.

\subsubsection{Log In medico:}
\paragraph{Attori:} Medico
\paragraph{Precondizioni:} E' necessaria una connessione ad internet. E' necessario che il medico abbia sottomano i dati del paziente.
\paragraph{Passi principali:}
\begin{enumerate}
	\item Il medico lancia l'applicazione.
	\item Il medico inserisce i campi email e password utilizzati nella fase di Sign Up.
	\item Il medico inserisce i dati del paziente nella form successiva alla fase di Log In.
\end{enumerate}
\paragraph{Situazioni eccezionali:}
\begin{enumerate}
	\item[1a.] Il medico lascia vuoti alcuni dati del paziente
	\item[1b.] L'applicazione risponde con un toggle, il quale segnala che alcuni campi sono da compilare e non permette l'avvio del gioco.
\end{enumerate}
\begin{enumerate}
	\item[2a.] L'utente inserisce una data di nascita non valida per il paziente.
	\item[2b.] L'applicazione risponde tramite una warning, segnalando che la data non è valida e non permettendo l' avvio del gioco.
\end{enumerate}
\paragraph{Postcondizioni:}
Le credenziali del paziente inserite dal medico sono corrette ed il gioco viene avviato.

\subsubsection{Update Info:}
\paragraph{Attori:} Utente 
\paragraph{Precondizioni:} E' necessaria una connessione ad internet.
\paragraph{Passi principali:}
\begin{enumerate}
	\item L'utente avvia l' applicazione.
	\item L'utente clicca sul link Update Your Info.
	\item L'utente sceglie la credenziale di cui vuole fare l' update.
	\item L'utente effettua il Log In utilizzando le credenziali precenti all'update.
	\item L'utente inserisce il nuovo valore della credenziale da modificare e clicca Ok.
\end{enumerate}
\paragraph{Situazioni eccezionali:}
\begin{enumerate}
	\item[1a.] Le credenziali di Log In non sono valide
	\item[1b.] L'applicazione risponde con un warning e rimanda alla schermata principale.
\end{enumerate}
\begin{enumerate}
	\item[2a.] La nuova credenziale inserita non è valida.
	\item[2b.] L'applicazione risponde tramite una warning, rimandando alla schermata principale.
\end{enumerate}
\paragraph{Postcondizioni:}
L'update delle credenziali selezionate viene eseguito correttamente.

\newpage
\section{Package Diagram}
Ecco una panoramica sui package della nostra app, adottiamo una strategia top-down, e partendo da un livello alto, aumentiamo via via il grado di dettaglio.

\begin{figure}[ht]
	\centering
	\includegraphics[width=130mm]{immagini/package_diagram}
	\caption{Package diagram}
	\label{package_diagram}
\end{figure}
\newpage
\section{Component diagram}
\subsection{Il sistema di Car Racing Cardboard}
Le due compoenenti principali del sistema Car Racing Cardboard sono il server cs.unibg.it e l'applicazione Andoid, queste due componenti comunicano con chiamate di tipo http post.\\
A differenza di GET, che permette a un server di mandare informazioni a un client, l'operazione POST fornisce ai client un modo per trasmettere informazioni ai server. 
La maggior parte dei browser web usa comunemente tale metodo per inviare forms ai server Web.
Il client manda un messaggio POST e include l'informazione che desidera mandare al server.
Il server può rimandare l'informazione stessa come parte della risposta \cite{httppost}. \\
\begin{figure}[ht]
	\centering
	\includegraphics[width=100mm]{immagini/component_sistema}
	\caption{Component diagram sistema}
	\label{component sistema}
\end{figure}

\subsection{L'applicazione Android}
Entranto nel dettaglio della prima componete, l'applicazione Android, offre il servizio di interfaccia grafica touch, mentre riceve dal server il servizio di scambio dati http.
I componenti grafici di Android si dividono in due categorie: View e ViewGroup. Una View è un qualunque componente utilizzabile (TextView, EditView, CheckBox, Button, ImageView, ?) in una interfaccia. Una ViewGroup è solitamente un layout che contiene un insieme di View, i più usati sono LinearLayout, RelativeLayout e TableLayout. Un ViewGroup è a sua volta una View, per questo possono essere creati layout complessi annidando a più livelli i vari componenti. View e ViewGroup sono un esempio di pattern composite.
Le interfacce grafiche in Android possono essere definite in due modi:\\
\begin{itemize}
	
\item definendo un file xml: ad ogni View corrisponde un tag xml, i ViewGroup sono tag xml che contengono all?interno altri tag;
\item scrivendo codice Java: ogni View ha una classe associata, è possibile aggiungere una View a un ViewGroup usando il metodo addView.
\end{itemize}
L'applicazione Car Racing Cardboard sfrutta entrambe le forme di componenti grafiche.\\
\begin{figure}[ht]
	\centering
	\includegraphics[width=100mm]{immagini/component_android}
	\caption{Component diagram applicazione Android}
	\label{component andoid}
\end{figure}
\subsection{Il server}
\subsection{Dettaglio applicazione}
\newpage
\section{Class diagram}
\newpage
\section{Sequence diagram}

%----------------------------------------------------------------------------------------
%	analisi degli algoritmi
%----------------------------------------------------------------------------------------

\chapter{Analisi degli Algoritmi}

\section{Penalizzazione progressiva delle immagini}
L'alpha value di un immagine è un valore che va da 0 a 255 e descrive la sua trasparenza. Un' immagine con alpha=0 è trasparente, mentre con aplha=255 conserva tutte le sue caratteristiche, con questo codice all' aumentare del livello, aumenta anche la trasparenza dell'immagine, dopo l'ottavo livello l'alpha rimane=50, continua però ad aumentare la difficoltà del gioco, in termini di nemici e velocità d'azione. \\
\begin{lstlisting}[language=Java]
	 /**
	 *
	 * @return Alpha value to penalize the image
	 */
	 private int getLevelPenalization(){
		 switch(globalData.getLevel()){
	 
			 case 1:{
				 return 200;
			 }
			 case 2:{
				 return 180;
			 }
			 case 3:{
				 return 160;
			 }
			 case 4:{
				 return 140;
			 }
			 case 5:{
				 return 120;
			 }
			 case 6:{
				 return 100;
			 }
			 case 7:{
				 return 80;
			 }
			 case 8:{
				 return 50;
			 }
			 default:{
				 return 50;
			 }
		 }
	 }
\end{lstlisting}
\newpage
\section{Generazione random scena}
\subsection{Nemici}
Nella scena ci sono tre \virgolette{corsie} dalle quali possono arrivare i \virgolette{nemici}, questo è il codice dal quale viene estratat la corsia scelta.
Inizialmente la corsia viene scelta a caso con un'estrazione random, ma per evitare che il giocatore resti troppo a lungo fermo nella stessa corsia senza muoversi viene fatto un controllo sulla scelta precedente. Un nemico non viene mai mandato più di due volte sulla stessa corsia.\\
\begin{lstlisting}[language=Java]
	public void randomFunction(){
		selectedLane=(int)(lane*Math.random())+1;
		if(previousLane==selectedLane){
			countPrevious++;
			if(countPrevious>3){
			   	selectedLane++;
				if(selectedLane>3){
						selectedLane=1;
				}
			}
		}
		previousLane=selectedLane;
		selectedCar=(int)(numberOfCar*Math.random())+1;	
	}
\end{lstlisting}
\newpage
\subsection{Panorama}
Analogamente ai nemici, anche il panorama viene modificato per rendere più avvincente l'ambientazione del gioco.\\

\begin{lstlisting}
public void randomPanorama() {
	int pick = new Random().nextInt(Side.values().length);
	selectedSide= Side.values()[pick];
	idSubject= (int)(numberOfSubject*Math.random())+1;
}
\end{lstlisting}

\newpage
\section{Cifratura password}

Le password degli utenti non vengono memorizzate nel Data Base in chiaro ma vengono cifrate (dallo smartphone) con un algoritmo sha256.\\

\begin{lstlisting}[language=Java]
	public static String calculateHash(String data) {
		String hash = new String(Hex.encodeHex(DigestUtils.sha256(data)));
		return hash;
	}
\end{lstlisting}
\newpage
\section{Servizio web}
\newpage
\section{Thread}
\newpage
\section{Asynctask}
Per ottimizzare l'utilizzo di memoria del device da parte dell'applicazione sono stati utilizzate i task asincroni (Asynctask) per la gestione di tutta la parte grafica dinamica.\\ 
In molti framework di sviluppo con interfacce grafiche i task lunghi non devono essere eseguiti nel thread principale dell?applicazione. Infatti il thread principale è quello che si occupa di gestire gli eventi che arrivano dall?interfaccia (per esempio il click di un pulsante), se questo thread è già occupato a eseguire qualcos'altro l'effetto che si ottiene è quello di un ritardo di esecuzione (lag)\cite{asynktask}. 
\paragraph{I quattro passi:} un Asynktask in android si divide in quattro \virgolette{step}
\begin{enumerate}
	\item onPreExecute(), invocato sul thread della UI\footnote{User Interface} priva che il task venga eseguito. Qui viene solitamento messo il setup del task
	\item doInBackground(Params...), invocato nel background del thread, subito dopo onPreExecute(). Questo step è usato per eseguire computazioni in background che possono durare molto tempo.
	Il risultato della computazione deve essere tornato in questo step, e possono essere pubblicati grazie a publishProgress(Progress...). I valori sono passati all' UI thread nello step onProgressUpdate(Progress...).
	\item onProgressUpdate(Progress...), invocato nell' UI thread dopo aver chiamato publicProgress(Progress...). Questo metodo è usato per mostrare ogni progresso nella UI mentre in backgrond la computazione è ancora in esecuzione
	\item onPostExecute(Result), invocato dopo che la computazione in background è finita.\cite{aos}.
\end{enumerate}
%----------------------------------------------------------------------------------------
%	tool
%----------------------------------------------------------------------------------------
\chapter{Toll utilizzati}
\section{GitHub}
\section{Crashlitics}

%----------------------------------------------------------------------------------------
%	social media
%----------------------------------------------------------------------------------------

\chapter{Social media}
\begin{figure}
	\centering
	\includegraphics[width=\columnwidth]{immagini/sito2}
	\caption{Car Racing Cardboard web site}
	\label{sito_web}
\end{figure}
La promozione dell'applicazione è stata effettuata con i mezzi che ad oggi sono più in voga, gli strumenti utilizzati sono stati Facebook\footnote{https://www.facebook.com/3D4Amb} e Google+\footnote{https://plus.google.com/u/1/110383688193490676162/posts}, è stato anche realizzato un sito internet\footnote{http://3d4amb.unibg.it/3dcar/cardboard\%20site/}.





%----------------------------------------------------------------------------------------
%   conclusioni
%----------------------------------------------------------------------------------------

\chapter{Conclusioni}

Lo scopo di questa applicazione è il trattamento dell'ambliopia, non è necessario avere a disposizione device costoso, al giorno d'oggi tutte le persone hanno uno smartphone e Goggole Cardboard è molto economico. Usando l'applicazione Car Racing Cardboard, le persone che soffrono di ambliopia possono migliorare il loro occhio pigro.\\
La tipologia di trattamento proposta da 3D4Amb, cerca di evitare i rischi della terapia occlusiva, ma può anche essere usata in parallelo con la terapia occlusiva\cite{rehab2015}. 
\paragraph{Certificazione contenuti:}
L'applicazione ha ricevuto delle certificazioni da Google Play Store:
\begin{figure}
	\centering
	\includegraphics[width=\columnwidth]{immagini/certifications.png}
	\caption{Classificazione contenuti}
	\label{classificaizone}
\end{figure}

\begin{itemize}
		\item Australian Classification Board (ACB) --	Australia
		\item Classificação Indicativa (ClassInd) --	Brazil
		\item Entertainment Software Rating Board (ESRB) --	North America
		\item Pan-European Game Information (PEGI) -- 	Europe
		\item Unterhaltungssoftware Selbstkontrolle (USK) -- Germany
		\item IARC Generic -- Rest of the world
		\item Google Play --South Korea	
\end{itemize}



\section{Paper}

%bibliografia
\bibliographystyle{abbrv}
\bibliography{tesi} 

\end{document}